<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nebula Cloud | Enterprise Hosting</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg: #0b0f1a;
            --surface: #161b2c;
            --accent: #6366f1;
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; touch-action: manipulation; }
        .hidden { display: none !important; }

        /* --- LOADER --- */
        #loading { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .loader-bar { width: 180px; height: 3px; background: var(--border); border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .loader-p { height: 100%; width: 0%; background: var(--accent); animation: load 3s linear forwards; }
        @keyframes load { to { width: 100%; } }

        /* --- LAYOUT --- */
        header { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--surface); }
        .main-content { padding: 20px; height: calc(100vh - 65px); overflow-y: auto; }
        
        .action-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 25px; }
        .btn-tile { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 18px 5px; display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: 0.2s; }
        .btn-tile:active { background: var(--accent); transform: scale(0.95); }
        .btn-tile span { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        /* --- LISTS & CARDS --- */
        .project-card { background: var(--surface); border: 1px solid var(--border); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 10px 16px; border-radius: 8px; border: none; font-weight: 700; font-size: 0.75rem; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        
        /* --- EDITOR --- */
        #editor { position: fixed; inset: 0; background: var(--bg); z-index: 900; display: flex; flex-direction: column; }
        .editor-header { padding: 12px 15px; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .editor-toolbar { padding: 8px 15px; background: #1e293b; border-bottom: 1px solid var(--border); display: flex; gap: 10px; }
        textarea { flex: 1; width: 100%; background: #000; color: #10b981; border: none; padding: 15px; font-family: 'Fira Code', monospace; font-size: 13px; outline: none; resize: none; }

        /* --- PUBLIC IFRAME --- */
        #public-view { position: fixed; inset: 0; background: white; z-index: 2000; }
        .preview-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 3000; }

        #console { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; padding: 20px; display: flex; align-items: center; }
        .term { background: #000; width: 100%; border-radius: 12px; border: 1px solid #333; height: 60vh; overflow-y: auto; padding: 15px; font-family: 'Fira Code'; color: #10b981; font-size: 0.8rem; line-height: 1.5; }
    </style>
</head>
<body>

<div id="loading">
    <h2 style="font-weight:800; letter-spacing:3px;">NEBULA</h2>
    <div class="loader-bar"><div class="loader-p"></div></div>
</div>

<div id="public-view" class="hidden">
    <div class="preview-nav">
        <button onclick="location.reload()" class="btn btn-accent">&#8635; REFRESH</button>
        <button onclick="window.location.href=window.location.pathname" class="btn" style="background:var(--danger); color:white;">&#10006; EXIT</button>
    </div>
    <iframe id="output-frame"></iframe>
</div>

<div id="app-root" class="hidden">
    <div id="auth" class="hidden" style="padding:40px; height:100vh; display:flex; flex-direction:column; justify-content:center;">
        <h1 style="margin-bottom:10px; font-weight:800;">Nebula Access</h1>
        <p style="color:var(--text-dim); margin-bottom:30px;">Initialize your cloud session</p>
        <input id="email" type="email" placeholder="Email" style="width:100%; padding:15px; margin-bottom:12px; background:var(--surface); border:1px solid var(--border); color:white; border-radius:12px; outline:none;">
        <input id="password" type="password" placeholder="Password" style="width:100%; padding:15px; margin-bottom:25px; background:var(--surface); border:1px solid var(--border); color:white; border-radius:12px; outline:none;">
        <button onclick="handleAuth()" class="btn btn-accent" style="padding:15px; justify-content:center; font-size:0.9rem;">CONTINUE &#10140;</button>
    </div>

    <div id="home" class="hidden">
        <header>
            <div style="font-weight:800; color:var(--accent); letter-spacing:1px;">NEBULA.SH</div>
            <button onclick="auth.signOut()" class="btn" style="color:var(--danger); background:none;">LOGOUT</button>
        </header>
        <div class="main-content">
            <div class="action-grid">
                <div class="btn-tile" onclick="createProject()">
                    <svg width="24" height="24" fill="var(--accent)" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    <span>New Host</span>
                </div>
                <div class="btn-tile" onclick="openDB()">
                    <svg width="24" height="24" fill="var(--text-dim)" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 4.69 2 8s4.48 6 10 6 10-2.69 10-6-4.48-6-10-6zm0 10c-4.42 0-8-1.79-8-4s3.58-4 8-4 8 1.79 8 4-3.58 4-8 4zM2 10v4c0 3.31 4.48 6 10 6s10-2.69 10-6v-4c0 3.31-4.48 6-10 6S2 13.31 2 10zm0 4v4c0 3.31 4.48 6 10 6s10-2.69 10-6v-4c0 3.31-4.48 6-10 6S2 17.31 2 14z"/></svg>
                    <span>Database</span>
                </div>
                <div class="btn-tile" onclick="openSettings()">
                    <svg width="24" height="24" fill="var(--text-dim)" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    <span>Settings</span>
                </div>
            </div>
            <h3 style="font-size:0.75rem; color:var(--text-dim); margin-bottom:15px; letter-spacing:1px; font-weight:800;">DEPLOYED INSTANCES</h3>
            <div id="project-list"></div>
        </div>
    </div>

    <div id="editor" class="hidden">
        <div class="editor-header">
            <button onclick="closeEditor()" class="btn btn-outline">&#10229; BACK</button>
            <div id="editor-title" style="font-size:0.8rem; font-weight:800; font-family:'Fira Code';">INDEX.HTML</div>
            <button onclick="deploy()" class="btn btn-accent">DEPLOY &#10148;</button>
        </div>
        <div class="editor-toolbar">
            <button onclick="pasteCode()" class="btn" style="background:#334155; color:white;">&#128203; PASTE CLIPBOARD</button>
            <button onclick="copyCode()" class="btn" style="background:#475569; color:white;">&#10064; COPY ALL</button>
        </div>
        <textarea id="code-area" spellcheck="false" placeholder="Paste or write your code here..."></textarea>
    </div>
</div>

<div id="console" class="hidden">
    <div class="term" id="logs"></div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDSCU7uFxMBi5W3OQHb55rZz3_hXROZRdI",
    authDomain: "zor-battle.firebaseapp.com",
    databaseURL: "https://zor-battle-default-rtdb.firebaseio.com",
    projectId: "zor-battle",
    storageBucket: "zor-battle.firebasestorage.app",
    messagingSenderId: "305211042481",
    appId: "1:305211042481:web:6ebef4c35e2abd80bb9090"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentProj = "";
const urlParams = new URLSearchParams(window.location.search);
const pubP = urlParams.get('project'), pubU = urlParams.get('u');

window.onload = () => {
    if(pubP && pubU) {
        document.getElementById("loading").classList.add("hidden");
        loadPublic(pubU, pubP);
        return;
    }
    setTimeout(() => {
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("app-root").classList.remove("hidden");
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById("auth").classList.add("hidden");
                document.getElementById("home").classList.remove("hidden");
                loadProjects();
            } else {
                document.getElementById("auth").classList.remove("hidden");
                document.getElementById("home").classList.add("hidden");
            }
        });
    }, 3000);
};

function loadPublic(uid, name) {
    db.ref(`projects/${uid}/${name}`).once('value', snap => {
        const d = snap.val();
        if(d) {
            document.getElementById("public-view").classList.remove("hidden");
            document.getElementById("output-frame").srcdoc = d.files['index.html'];
        }
    });
}

function loadProjects() {
    db.ref(`projects/${auth.currentUser.uid}`).on("value", snap => {
        const data = snap.val();
        const list = document.getElementById("project-list");
        list.innerHTML = "";
        if(!data) {
            list.innerHTML = "<div style='text-align:center; padding:40px; color:var(--text-dim);'>No projects added.</div>";
            return;
        }
        Object.keys(data).forEach(name => {
            const div = document.createElement("div");
            div.className = "project-card";
            div.innerHTML = `
                <div style="font-weight:700; font-family:'Fira Code'; font-size:0.85rem;">${name.toUpperCase()}</div>
                <div style="display:flex; gap:8px;">
                    <button class="btn btn-accent" style="background:var(--success);" onclick="window.location.href='?project=${name}&u=${auth.currentUser.uid}'">VIEW</button>
                    <button class="btn btn-outline" onclick="editProj('${name}', '${btoa(unescape(encodeURIComponent(data[name].files['index.html'])))}')">EDIT</button>
                    <button class="btn" style="background:var(--danger); color:white;" onclick="deleteProj('${name}')">&#128465;</button>
                </div>`;
            list.appendChild(div);
        });
    });
}

function editProj(name, code64) {
    currentProj = name;
    document.getElementById("home").classList.add("hidden");
    document.getElementById("editor").classList.remove("hidden");
    document.getElementById("code-area").value = decodeURIComponent(escape(atob(code64)));
}

function createProject() {
    const n = prompt("Unique Project Identifier (No spaces):");
    if(!n || n.includes(" ")) return;
    currentProj = n;
    document.getElementById("home").classList.add("hidden");
    document.getElementById("editor").classList.remove("hidden");
    document.getElementById("code-area").value = "<!DOCTYPE html>\n<html>\n<body>\n <h1>Hello World</h1>\n</body>\n</html>";
}

function deleteProj(name) {
    if(confirm(`Permanent delete ${name}?`)) db.ref(`projects/${auth.currentUser.uid}/${name}`).remove();
}

function closeEditor() {
    document.getElementById("editor").classList.add("hidden");
    document.getElementById("home").classList.remove("hidden");
}

async function pasteCode() {
    try {
        const t = await navigator.clipboard.readText();
        document.getElementById("code-area").value = t;
    } catch(e) { alert("Clipboard permission required"); }
}

function copyCode() {
    const a = document.getElementById("code-area");
    a.select();
    document.execCommand("copy");
}

async function deploy() {
    const c = document.getElementById("code-area").value;
    const con = document.getElementById("console");
    const l = document.getElementById("logs");
    con.classList.remove("hidden");
    l.innerHTML = "";
    
    const steps = ["Initalizing Node...", "Uploading Bundle...", "Configuring DNS...", "SSL Handshake...", "DEPLOYED"];
    for(let s of steps) {
        await new Promise(r => setTimeout(r, Math.random()*1200 + 400));
        l.innerHTML += `> ${s}<br>`;
    }
    
    await db.ref(`projects/${auth.currentUser.uid}/${currentProj}`).set({ files: { "index.html": c } });
    setTimeout(() => { con.classList.add("hidden"); closeEditor(); }, 1200);
}

async function handleAuth() {
    const e = email.value, p = password.value;
    try { await auth.signInWithEmailAndPassword(e, p); }
    catch { await auth.createUserWithEmailAndPassword(e, p); }
}

function openDB() { alert("Database Node V1 Active - Use Firebase API in your code."); }
function openSettings() { alert("Region: Global-Edge-1 | SSL: Auto-Active"); }
</script>

</body>
</html>
