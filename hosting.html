<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cloud Host Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg: white;
  --text: black;
  --card: #f3f3f3;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f172a;
    --text:white;
    --card:#1e293b;
  }
}
body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}
.center{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  flex-direction:column;
}
.loading-bar{
  width:200px;
  height:5px;
  background:gray;
  overflow:hidden;
}
.loading-bar div{
  height:100%;
  width:0%;
  background:lime;
  animation:load 3s linear forwards;
}
@keyframes load{
  to{width:100%;}
}
.card{
  background:var(--card);
  padding:20px;
  margin:10px;
  border-radius:10px;
}
input, textarea{
  width:100%;
  padding:8px;
  margin-top:5px;
}
button{
  padding:8px 15px;
  margin-top:10px;
  cursor:pointer;
}
.project{
  padding:10px;
  background:var(--card);
  margin-top:10px;
  border-radius:8px;
}
.fab{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#00ffcc;
  color:black;
  width:50px;
  height:50px;
  border-radius:50%;
  font-size:30px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}
.hidden{display:none;}
</style>
</head>
<body>

<div id="loading" class="center">
<h2>Loading...</h2>
<div class="loading-bar"><div></div></div>
</div>

<div id="auth" class="center hidden">
<div class="card">
<h2>Login / Register</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="register()">Register</button>
</div>
</div>

<div id="home" class="hidden">
<h2 style="padding:10px;">Your Projects</h2>
<div id="projects"></div>
<div id="noProject" style="padding:10px;">No project added ðŸš€</div>
<div class="fab" onclick="createProject()">+</div>
</div>

<div id="editor" class="hidden" style="padding:10px;">
<h2 id="projectTitle"></h2>
<input id="fileName" placeholder="filename.html / file.js">
<textarea id="fileCode" rows="10" placeholder="Write code here..."></textarea>
<button onclick="addFile()">Add File</button>
<div id="fileList"></div>
<button onclick="saveProject()">Save Project</button>
<button onclick="backHome()">Back</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDSCU7uFxMBi5W3OQHb55rZz3_hXROZRdI",
  authDomain: "zor-battle.firebaseapp.com",
  databaseURL: "https://zor-battle-default-rtdb.firebaseio.com",
  projectId: "zor-battle",
  storageBucket: "zor-battle.firebasestorage.app",
  messagingSenderId: "305211042481",
  appId: "1:305211042481:web:6ebef4c35e2abd80bb9090"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

setTimeout(()=>{
  document.getElementById("loading").classList.add("hidden");
  document.getElementById("auth").classList.remove("hidden");
},3000);

function login(){
  auth.signInWithEmailAndPassword(email.value,password.value);
}
function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value);
}

auth.onAuthStateChanged(user=>{
  if(user){
    authScreen(false);
    loadProjects();
  }
});

function authScreen(show){
  document.getElementById("auth").classList.toggle("hidden",!show);
  document.getElementById("home").classList.toggle("hidden",show);
}

function loadProjects(){
  db.ref("projects/"+auth.currentUser.uid).on("value",snap=>{
    const data=snap.val();
    const container=document.getElementById("projects");
    container.innerHTML="";
    if(!data){
      document.getElementById("noProject").style.display="block";
      return;
    }
    document.getElementById("noProject").style.display="none";
    Object.keys(data).forEach(name=>{
      const div=document.createElement("div");
      div.className="project";
      div.innerHTML=name;
      div.onclick=()=>openProject(name,data[name]);
      container.appendChild(div);
    });
  });
}

let currentProject="";
let files={};

function createProject(){
  const name=prompt("Enter Project Name");
  if(!name)return;
  currentProject=name;
  files={};
  showEditor();
}

function openProject(name,data){
  currentProject=name;
  files=data.files||{};
  showEditor();
}

function showEditor(){
  document.getElementById("home").classList.add("hidden");
  document.getElementById("editor").classList.remove("hidden");
  document.getElementById("projectTitle").innerText=currentProject;
  renderFiles();
}

function addFile(){
  const fname=fileName.value.trim();
  const code=fileCode.value;
  if(!fname.includes(".")){alert("Invalid file name");return;}
  files[fname]=code;
  renderFiles();
}

function renderFiles(){
  const list=document.getElementById("fileList");
  list.innerHTML="";
  Object.keys(files).forEach(f=>{
    const div=document.createElement("div");
    div.className="project";
    div.innerHTML=f+" <button onclick='deleteFile(\""+f+"\")'>Delete</button>";
    list.appendChild(div);
  });
}

function deleteFile(f){
  delete files[f];
  renderFiles();
}

function saveProject(){
  db.ref("projects/"+auth.currentUser.uid+"/"+currentProject)
  .set({files});
  alert("Saved âœ…");
}

function backHome(){
  document.getElementById("editor").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
}

</script>
</body>
</html>