<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inspect & Edit HTML Live — Single file</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <style>
    :root{--bg:#0f1724;--panel:#0b1220;--muted:#9aa4b2;--accent:#06b6d4}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,system-ui,Roboto,-apple-system; background:linear-gradient(180deg,#071025 0%, #071826 100%);color:#e6eef6}
    .app{display:grid;grid-template-columns:520px 1fr;gap:12px;height:100vh;padding:14px}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.02);margin-bottom:6px}
    .controls{display:flex;gap:8px}
    button{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
    button.primary{background:var(--accent);color:#052025;border:none}
    .editor-pane{display:flex;flex-direction:column;gap:8px}
    .editor-toolbar{display:flex;align-items:center;justify-content:space-between}
    .editor-toolbar .left{display:flex;gap:8px;align-items:center}
    .preview{height:calc(100vh - 140px);border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.04)}
    iframe{width:100%;height:100%;border:0;background:white}
    .inspect-panel{position:fixed;right:18px;bottom:18px;width:420px;background:rgba(2,6,23,0.95);border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:10px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    .inspect-panel h4{margin:0 0 8px 0;color:#fff}
    .inspect-panel textarea{width:100%;height:160px;background:#071026;color:#e6eef6;border:1px solid rgba(255,255,255,0.03);border-radius:6px;padding:8px}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:980px){.app{grid-template-columns:1fr;}
      header{position:sticky;top:0;z-index:5}
      .preview{height:360px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <strong>Inspect & Edit HTML Live</strong>
        <div class="small">Single-file demo — edit code, live preview, inspect elements & edit them</div>
      </div>
      <div class="controls">
        <button id="runBtn" class="primary">Run / Apply</button>
        <button id="toggleInspect">Toggle Inspect</button>
        <button id="beautifyBtn">Beautify HTML</button>
        <button id="downloadBtn">Download</button>
        <button id="resetBtn">Reset</button>
      </div>
    </header><section class="editor-pane">
  <div class="editor-toolbar">
    <div class="left"><span class="small">HTML Editor</span></div>
    <div class="small">Tip: Toggle Inspect and click elements in preview to edit them.</div>
  </div>
  <textarea id="code" spellcheck="false">

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Demo Page</title>
    <style>
      body{font-family:Inter,system-ui,Arial;padding:28px;line-height:1.6}
      .card{padding:18px;border-radius:10px;box-shadow:0 4px 18px rgba(2,6,23,0.25);background:linear-gradient(90deg,#fff,#f1f5f9);color:#07203a}
      .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#06b6d4;color:white;text-decoration:none}
    </style>
  </head>
  <body>
    <h1>Hello — edit me!</h1>
    <p>This is a small demo page. Click the blue card to edit it using the inspector.</p><div class="card">
  <h3>Card title</h3>
  <p>Some content inside the card. <a href="#" class="btn">Click</a></p>
</div>

  </body>
</html>
      </textarea>
    </section><section>
  <div class="preview" id="previewWrap">
    <iframe id="preview" sandbox="allow-scripts allow-forms"></iframe>
  </div>
</section>

  </div>  <div id="inspectPanel" class="inspect-panel" style="display:none">
    <h4>Inspect & Edit Element</h4>
    <div class="small" id="selectedPath">Selected: <span style="opacity:0.9">—</span></div>
    <textarea id="elementHtml"></textarea>
    <div style="display:flex;justify-content:space-between;gap:8px;margin-top:8px">
      <button id="replaceBtn">Replace element in preview</button>
      <button id="closePanel">Close</button>
    </div>
  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>  <script>
    // Initialize CodeMirror
    const textarea = document.getElementById('code');
    const editor = CodeMirror.fromTextArea(textarea, {
      mode: 'xml', htmlMode: true, lineNumbers: true, tabSize:2, indentWithTabs:false
    });

    const preview = document.getElementById('preview');
    const runBtn = document.getElementById('runBtn');
    const toggleInspect = document.getElementById('toggleInspect');
    const beautifyBtn = document.getElementById('beautifyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');

    const inspectPanel = document.getElementById('inspectPanel');
    const elementHtml = document.getElementById('elementHtml');
    const selectedPath = document.getElementById('selectedPath');
    const replaceBtn = document.getElementById('replaceBtn');
    const closePanel = document.getElementById('closePanel');

    let inspectEnabled = false;
    let lastSelectedPath = null;

    function buildPreviewContent(html){
      // inject small script into the HTML that sets up inspection listeners and highlights
      const inspectorScript = `\n<script>\n(function(){\n  function getSelector(el){\n    if(!el) return '';\n    let path = [];\n    while(el && el.nodeType===1 && el.tagName.toLowerCase() !== 'html'){\n      let name = el.tagName.toLowerCase();\n      if(el.id) { name += '#'+el.id; path.unshift(name); break;}\n      let sib = el, idx = 1;\n      while(sib.previousElementSibling){ sib = sib.previousElementSibling; if(sib.tagName === el.tagName) idx++; }
      if(idx > 1) name += ':nth-of-type('+idx+')';\n      path.unshift(name); el = el.parentElement;\n    }\n    return path.join(' > ');\n  }\n  var overlay = null;\n  function ensureOverlay(){n if(overlay) return;}
  window.addEventListener('mousemove', function(e){ if(window._inspectActive){ var el = e.target; el.style.outline = '3px solid rgba(6,182,212,0.6)'; setTimeout(function(){ try{el.style.outline=''}catch(_){} }, 120); } }, true);
  document.addEventListener('click', function(ev){ if(window._inspectActive){ ev.preventDefault(); ev.stopPropagation(); var el = ev.target; var sel = getSelector(el); var payload = {type:'inspect-click', selector: sel, outer: el.outerHTML}; parent.postMessage(payload, '*'); } }, true);
  // listen for messages from parent to toggle inspect
  window.addEventListener('message', function(ev){ try{ var d=ev.data; if(d && d.type==='toggle-inspect'){ window._inspectActive = !!d.on; } if(d && d.type==='replace' && d.selector){ try{ var target = document.querySelector(d.selector); if(target){ target.outerHTML = d.newHtml; parent.postMessage({type:'replace-done', selector:d.selector, success:true}, '*'); } else parent.postMessage({type:'replace-done', selector:d.selector, success:false}, '*'); }catch(err){ parent.postMessage({type:'replace-done', selector:d.selector, success:false, error:String(err)}, '*'); } } }catch(e){} }, false);
})();\n<\/script>\n`;
      return html + inspectorScript;
    }

    function runPreview(){
      const html = editor.getValue();
      preview.srcdoc = buildPreviewContent(html);
    }

    runBtn.addEventListener('click', runPreview);

    toggleInspect.addEventListener('click', ()=>{
      inspectEnabled = !inspectEnabled;
      toggleInspect.style.opacity = inspectEnabled ? '1' : '0.8';
      // send message to iframe to enable inspect
      try{ preview.contentWindow.postMessage({type:'toggle-inspect', on:inspectEnabled}, '*'); }catch(e){}
    });

    beautifyBtn.addEventListener('click', ()=>{
      const content = editor.getValue();
      const pretty = html_beautify(content, {indent_size:2});
      editor.setValue(pretty);
    });

    downloadBtn.addEventListener('click', ()=>{
      const blob = new Blob([editor.getValue()], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'page.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    resetBtn.addEventListener('click', ()=>{
      if(confirm('Reset editor to the default demo HTML?')){
        editor.setValue(document.querySelector('#code').value);
        runPreview();
      }
    });

    // listen to messages from iframe
    window.addEventListener('message', function(ev){
      const d = ev.data || {};
      if(d.type === 'inspect-click'){
        lastSelectedPath = d.selector;
        selectedPath.querySelector('span').textContent = d.selector;
        elementHtml.value = d.outer;
        inspectPanel.style.display = 'block';
      }
      if(d.type === 'replace-done'){
        if(d.success){
          // refresh editor to current iframe HTML
          try{ const doc = preview.contentDocument || preview.contentWindow.document; const full = doc.documentElement.outerHTML; editor.setValue(full); alert('Replaced successfully — editor updated'); }catch(e){ alert('Replaced, but unable to sync editor: '+e); }
        } else { alert('Replace failed'); }
      }
    }, false);

    replaceBtn.addEventListener('click', ()=>{
      if(!lastSelectedPath){ alert('No element selected'); return; }
      const newHtml = elementHtml.value;
      // send message to iframe to replace
      try{ preview.contentWindow.postMessage({type:'replace', selector:lastSelectedPath, newHtml:newHtml}, '*'); }catch(e){ alert('Unable to send replace message'); }
    });

    closePanel.addEventListener('click', ()=>{ inspectPanel.style.display='none'; });

    // initial run
    setTimeout(runPreview, 100);
  </script></body>
</html>